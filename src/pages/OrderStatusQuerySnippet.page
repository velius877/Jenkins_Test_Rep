<apex:page standardController="Orders__c" extensions="OrderStatusQueryController" action="{!init}" showHeader="false" sidebar="false" tabStyle="Orders__c">
	<c:jQueryInit bLoadingPanel="true"/> 
	<script>
		var j$ = jQuery.noConflict();
		j$(document).load(function() {
			alert('loaded');
			queryOrderStatus();
		});
	</script>
	<apex:form id="OrderStatusSnippet" >
	<apex:pageMessages />
		<apex:outputPanel id="parentPanel" >
			<apex:pageBlock mode="detail" title="Order and Line Item Status Updates" rendered="{!showResults}" >
				<apex:pageBlockButtons location="top">
					<apex:commandButton action="{!processOrderPrewarehouseCancel}" value="Pre-Warehouse Cancel" id="CancelpreWarehouseBtn" rendered="{!showPreWareHouseCancel}" onClick="showProgressBar('Attempting to Cancel Order... Please wait.');" onComplete="hideProgressBar();"  rerender="OrderStatusSnippet"/>
					<apex:commandButton action="{!processOrderPOSTwarehouseCancel}" value="Post-Warehouse Cancel" id="CancelPostWarehouseBtn" rendered="{!showPostWareHouseCancel}" onClick="showProgressBar('Attempting to Cancel Order... Please wait.');" onComplete="hideProgressBar();" rerender="OrderStatusSnippet"/>
					<apex:selectList value="{!selectedDisposition}" id="despositionNumber" styleClass="select-lg" rendered="{!showPostWareHouseCancel}" multiselect="false" size="1" >
					<apex:selectOptions value="{!DispositionList}" /></apex:selectList>
					<apex:commandButton action="{!processOrderBackOrderCancel}" value="Back Order Cancel" id="CancelBackOrderBtn" rendered="{!showBackOrderCancel}" onClick="showProgressBar('Attempting to Cancel Order... Please wait.');" onComplete="hideProgressBar();"  rerender="OrderStatusSnippet"/>
				</apex:pageBlockButtons>
				<apex:outputPanel id="CancelOrderPanel" layout="block" rendered="{!showCancelOrderPanel}">
					<div>
						<table width="80%" align="center">
							<tr><td colspan="3"><hr/></td></tr>
							<tr>
								<td align="right" width="30%"><label for="cancelReason">Cancelled Reason:</label></td>
								<td align="left" width="20%">
									<apex:selectList value="{!selectedCancelReason}"
										id="select-cancel-reason" styleClass="select-lg"
										multiselect="false" size="1">
										<apex:selectOptions value="{!cancelReasonList}" />
									</apex:selectList> 
								</td>
								<td align="left">
								</td>
							</tr>
							<tr><td colspan="3"><hr/></td></tr>
						</table>
					</div>
				</apex:outputPanel>
				<apex:outputPanel id="resultsPanel" rendered="{!showResults}" >
					<apex:pageBlockSection title="Order Status Update" columns="3" showHeader="false">
						<!-- <apex:outputText value="{!rawResponse.SFOrderNumber}" label="Order Number:" rendered="{!!noCallout}"/> -->
						<apex:outputText value="{!olisd.Order__r.Name}" label="Order Number:" />
						<apex:outputText value="{!olisd.Order_Status_Code__c}" label="Current Status Code:"/>
						<apex:outputText value="{!olisd.Order_Status__c}" label="Current Status:"/>
					</apex:pageBlockSection>
					<apex:pageBlockSection title="Line Item Status Updates" columns="1" showHeader="false">
						<apex:pageBlockTable value="{!ordStatusDetails}" var="olisds" >
							<apex:column value="{!olisds.Order_Line_Item__r.Name}" headerValue="Line Number"/>
							<apex:column value="{!olisds.Current_Sku__c}" headerValue="Current Item Number"/>
							<apex:column value="{!olisds.Previous_Sku__c}" headerValue="Previous Item Number"/>
							<apex:column value="{!olisds.Current_Status_Code__c}" headerValue="Line Status Code"/>
							<apex:column value="{!olisds.Current_Status__c}" headerValue="Line Status Detail"/>
							<apex:column value="{!olisds.Current_Quantity__c}" headerValue="Current Quantity"/>
							<apex:column value="{!olisds.Previous_Quantity__c}" headerValue="Previous Quantity"/>
							<apex:column value="{!olisds.Tracking_Number__c}" headerValue="Tracking Number"/>
							<apex:column value="{!olisds.Shipper__c}" headerValue="Shipper"/>
							<apex:column value="{!olisds.Disposition_Number__c}" headerValue="Disposition Number"/>
							<apex:column value="{!olisds.Free_Item__c}" headerValue="Free Item?"/>
						</apex:pageBlockTable>
					</apex:pageBlockSection>
				</apex:outputPanel>
				<apex:outputPanel id="errorPanel" rendered="{!showError}" >
					<apex:pageBlockSection title="Order Error Update" columns="2" showHeader="false">
						<apex:outputText value="{!fault.code}" label="Status Code:"/>
						<apex:outputText value="{!fault.msg}" label="Status Message:"/>
					</apex:pageBlockSection>
				</apex:outputPanel>
				<apex:outputPanel id="noResults" rendered="{!noResults}" >
					<!-- <apex:pageMessages /> -->
				</apex:outputPanel>
			</apex:pageBlock>
		</apex:outputPanel>
		<apex:actionFunction name="queryOrderStatus" action="{!init}" rerender="parentPanel"  />
	</apex:form>
</apex:page>