<apex:page standardController="Orders__c" extensions="Order_DetailsExtension,OrderLineItemArchiveSnippet,OrderStatusQueryController"   >
	  <c:jQueryInit bLoadingPanel="true"/> 
	<script>

		var j$ = jQuery.noConflict();
		
		j$(document).ready(function() {
			sforce.console.setTabTitle('{!orderSObj.name}');
			
		});
		
		j$(document).ready(function() {		
			queryOrderStatus();
		});
		
		function dispAdminCancelConfirm() {
			var r=confirm('You are about to cancel the order, regardless of its status.  Are you sure you want to cancel the order in Salesforce?');
			if (r==true) {
				showProgressBar('Attempting to Cancel Order... Please wait.');
			}
			else{}
		
		}
		
		function dispPostSubmitConfirm(message) {
			var r=confirm(message);
			if (r==true) {
				showProgressBar('Attempting to Cancel Order... Please wait.');
				return true;
			}
			else{ return;}
			}
	</script>
	

	<apex:form id="OrderDetail">
		<apex:outputPanel id="error-msg">
			<apex:pageMessages />
		</apex:outputPanel>
	

		<apex:outputPanel id="ButtonsPanel">
		<center>
		<apex:commandButton action="{!processBackOfficeEdit}" value="Back Office Edit" id="BOEditBtn" rendered="{!showBackOfficeEdit}"/>
		<apex:commandButton action="{!edit}" value="Edit" id="EditBtn" rendered="{!showEditBtn}"/>
		<apex:commandButton action="{!URLFOR($Action.Orders__c.Clone,Orders__c.id)}" value="Clone" id="CloneBtn" rendered="{!showCloneBtn}" />
		<apex:commandButton action="{!processInternalReviewBtn}" value="Internal Review" id="InternalReviewBtn" rendered="{!showInternalReviewBtn}" rerender="OrderDetail"/>
		<apex:commandButton action="{!processOrderCancelBtn}" value="Cancel Order" id="CancelOrderBtn" rendered="{!showCancelOrderBtn}" rerender="OrderDetail,detailForm"/>
		<apex:commandButton action="{!processOrderCancelBtn_Admin}" value="Force Cancel" id="CancelOrderBtn_Admin" rendered="{!showAdminCancelBtn}" rerender="OrderDetail"/>
		<apex:commandButton action="{!processReleaseOrder}" value="Release Order" id="releaseOrderBtn" rendered="{!showReleaseOrder}"/>
		<apex:commandButton action="{!releasePotentialFraud}" value="Remove Fraud" id="fraud" rendered="{!showFraudRelease}"/>
		</center>
		</apex:outputPanel>
		
		<apex:outputPanel id="statusSnippet">
			<c:OrderStatusQuery rendered="{!statusQueryController.showSnippet}" queryController="{!statusQueryController}"/>
		</apex:outputPanel>
	
		<apex:outputPanel id="CancelOrderPanel" layout="block" rendered="{!showCancelOrderPanel}">
			<div>
			<table width="80%" align="center">
				<tr><td colspan="3"><hr/></td></tr>
				<tr>
					<td align="right" width="30%"><label for="cancelReason">Cancelled Reason:</label></td>
					<td align="left" width="20%">
						<apex:selectList value="{!selectedCancelReason}"
							id="select-cancel-reason" styleClass="select-lg"
							multiselect="false" size="1">
							<apex:selectOptions value="{!cancelReasonList}" />
						</apex:selectList>
					</td>
					<td align="left">
						<apex:commandButton rendered="{!!showAdminCancelSave}" onClick="showProgressBar('Attempting to Cancel Order... Please wait.');" onComplete="hideProgressBar();"   action="{!saveCancelOrder}" value="Save" id="CancelReasonBtn" rerender="OrderDetail,error-msg"/> &nbsp;
						<apex:commandButton rendered="{!showAdminCancelSave}" onClick="dispAdminCancelConfirm();" onComplete="hideProgressBar();"   action="{!saveCancelOrder_Admin}" value="Save" id="CancelReasonBtn_Admin" rerender="OrderDetail,error-msg"/> &nbsp;
						<apex:commandButton value="Cancel" id="CancelBtn" rerender="OrderDetail,error-msg" action="{!processCancel}"/>
					</td>
				</tr>
				<tr><td colspan="3"><hr/></td></tr>
			</table>
			</div>
		</apex:outputPanel>
		<apex:outputPanel id="InternalReviewPanel" layout="block" rendered="{!showInternalReviewPanel}">
			<div>
			<table width="80%" align="center">
				<tr><td colspan="3"><hr/></td></tr>
				<tr>
					<td align="right" width="30%"><label for="internalReviewReason">Internal Review Reason:</label></td>
					<td align="left" width="20%"> 
						<apex:selectList value="{!selectedReviewReason}"
							id="select-review-reason" styleClass="select-lg"
							multiselect="false" size="1">
							<apex:selectOptions value="{!reviewReasonList}" />
						</apex:selectList>
					</td>
					<td align="left"> 
						<apex:commandButton action="{!saveInternalReview}" value="Save" id="InternalReviewReasonBtn" rerender="OrderDetail,error-msg"/>&nbsp;
						<apex:commandButton value="Cancel" id="CancelBtn2" rerender="OrderDetail,error-msg" action="{!processCancel}" />
					</td>
				</tr>
				<tr><td colspan="3"><hr/></td></tr>
			</table>
			</div>
		</apex:outputPanel>
		<apex:actionFunction name="queryOrderStatus" action="{!statusQueryController.init}" rerender="statusSnippet"  />
	</apex:form>

	<apex:outputPanel rendered="{!oliList.size>0}">
		<apex:pageBlock >
			<apex:pageBlockTable value="{!oliList}" var="oli">
				<apex:column value="{!oli.Line_Number__c}"/>
				<apex:column value="{!oli.Product_Name__c}"/>
				<apex:column value="{!oli.Quantity_Shipped__c}"/>
				<apex:column value="{!oli.Final_Price__c}"/>
				<apex:column value="{!oli.Shipped_Date__c}"/>
				<apex:column value="{!oli.Shipment_Tracking_Number__c}"/>
			</apex:pageBlockTable>
		</apex:pageBlock>
	</apex:outputPanel>
	<apex:outputPanel id="detailForm">
		<apex:detail relatedList="true"/>
	</apex:outputPanel>

</apex:page>